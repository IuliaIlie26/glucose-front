<div class="container-fluid">
    <p-confirmDialog [style]="{width: '50vw'}" [baseZIndex]="10000"></p-confirmDialog>
    <p-messages [value]="message"></p-messages>
    <div class="row col-12">
        <p-table #dt [value]="patients" dataKey="id" styleClass="ui-table-patients" [rowHover]="true" [rows]="10"
            [showCurrentPageReport]="true" [rowsPerPageOptions]="[10,25,50]" [loading]="loading" [paginator]="true"
            currentPageReportTemplate="{last}/{totalRecords}" [filterDelay]="0"
            [globalFilterFields]="['name','lastname','cnp','fullAddress', 'email']">
            <ng-template pTemplate="caption">
                <span style="color: green;">{{"patient.manage.subtitle" | translate}}</span>
                <div class="ui-table-globalfilter-container">
                    <input pInputText type="text" (input)="dt.filterGlobal($event.target.value, 'contains')"
                        [placeholder]="'menu.search.global' | translate" />
                </div>
            </ng-template>
            <ng-template pTemplate="header">
                <tr>
                    <th pSortableColumn="name">{{'patient.create.name'|translate}}
                        <p-sortIcon field="name"></p-sortIcon>
                    </th>
                    <th pSortableColumn="lastname">{{'patient.create.lastname'|translate}}
                        <p-sortIcon field="lastname"></p-sortIcon>
                    </th>
                    <th pSortableColumn="cnp">{{'patient.create.cnp'|translate}}
                        <p-sortIcon field="cnp"> </p-sortIcon>
                    </th>
                    <th pSortableColumn="phone">{{'patient.create.phone.number'|translate}}
                        <p-sortIcon field="phone"> </p-sortIcon>
                    </th>
                    <th pSortableColumn="email">{{'patient.create.email'|translate}}
                        <p-sortIcon field="email"></p-sortIcon>
                    </th>
                    <th pSortableColumn="fullAddress">{{'patient.create.header.address'|translate}}
                        <p-sortIcon field="fullAddress"></p-sortIcon>
                    </th>
                    <th></th>
                    <th></th>
                </tr>
                <tr>
                    <th>
                        <input pInputText type="text" style="width: fit-content;"
                            (input)="dt.filter($event.target.value, 'name', 'startsWith')"
                            [placeholder]="'menu.search.byName' | translate" class="ui-column-filter">
                    </th>
                    <th>
                        <input pInputText type="text" style="width: fit-content;"
                            (input)="dt.filter($event.target.value, 'lastname', 'startsWith')"
                            [placeholder]="'menu.search.byLastName' | translate" class="ui-column-filter">
                    </th>
                    <th>
                        <input pInputText type="text" style="width: 80%"
                            (input)="dt.filter($event.target.value, 'cnp', 'startsWith')"
                            [placeholder]="'menu.search.byCNP' | translate" class="ui-column-filter">
                    </th>
                    <th>
                        <input pInputText type="text" style="width: fit-content;"
                            (input)="dt.filter($event.target.value, 'phone', 'startsWith')"
                            [placeholder]="'menu.search.byPhone' | translate" class="ui-column-filter">
                    </th>
                    <th>
                        <input pInputText type="text" style="width: fit-content;"
                            (input)="dt.filter($event.target.value, 'email', 'startsWith')"
                            [placeholder]="'menu.search.byEmail' | translate" class="ui-column-filter">
                    </th>
                    <th>
                        <input pInputText type="text" style="width: fit-content;"
                            (input)="dt.filter($event.target.value, 'fullAddress', 'contains')"
                            [placeholder]="'menu.search.byAddress' | translate" class="ui-column-filter">
                    </th>
                    <th></th>
                    <th></th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-patient>
                <tr class="ui-selectable-row">
                    <td>
                        <span style="vertical-align: middle; margin-left: .5em"> {{patient.name}}</span>
                    </td>
                    <td>
                        <span style="vertical-align: middle; margin-left: .5em">{{patient.lastname}}</span>
                    </td>
                    <td>
                        <span style="vertical-align: middle; margin-left: .5em">{{patient.cnp}}</span>
                    </td>
                    <td>
                        <span style="vertical-align: middle; margin-left: .5em"> {{patient.phone}}</span>
                    </td>
                    <td>
                        <span style="vertical-align: middle; margin-left: .5em"> {{patient.email}}</span>
                    </td>
                    <td>
                        <span style="vertical-align: middle; margin-left: .5em"> {{patient.fullAddress}}</span>
                    </td>
                    <td>
                        <button pButton type="button" class="ui-button-secondary" icon="fa fa-edit"
                            pTooltip="{{'patient.manage.edit' | translate}}" tooltipPosition="top"
                            (click)="edit(patient)"></button>
                    </td>
                    <td>
                        <button pButton type="button" class="ui-button-secondary" icon="fa fa-trash"
                            pTooltip="{{'patient.manage.delete' | translate}}" tooltipPosition="top"
                            (click)="onDelete(patient.id)"></button>
                    </td>
                </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
                <tr>
                    <td colspan="8" style="text-align:center; color:indianred;">{{'datatable.no_data' | translate}}</td>
                </tr>
            </ng-template>
        </p-table>
    </div>


    <p-dialog *ngIf="selectedPatient" header="{{'patient.manage.edit' | translate}}" [(visible)]="showEditModal"
        [blockScroll]="true" position="top" [baseZIndex]="10000">
        <div class="col-12">
            <div class="row form-group">
                <div class="col-6">
                    <label class="text-right col-form-label">
                        <sup>*</sup>{{"patient.create.name" | translate}}:
                    </label>
                    <input class="ml-4" type=" text" [(ngModel)]="selectedPatient.name" />
                </div>
                <div class="col-6">
                    <label class="text-right col-form-label ">
                        <sup>*</sup>{{"patient.create.lastname" | translate}}:
                    </label>
                    <input class="ml-4" type="text" [(ngModel)]=" selectedPatient.lastname" />
                </div>
            </div>
            <div class="row form-group">
                <div class="col-6 form-group">
                    <label class="text-right col-form-label">
                        <sup>*</sup>{{"patient.create.cnp" | translate}}:
                    </label>
                    <input class="ml-4" type="text" [(ngModel)]=" selectedPatient.cnp" maxlength="13" numbersOnly />
                </div>
                <div class="col-6 form-group">
                    <label class="text-right col-form-label">
                        <sup>*</sup>{{"patient.create.birthdate" | translate}}
                    </label>
                    <p-calendar class="ui-calendar" [(ngModel)]="selectedPatient.birthdate" [showIcon]="true"
                        icon="fa fa-calendar" [monthNavigator]="true" [yearNavigator]="true" [maxDate]="maxDate"
                        yearRange="1950:2020" dateFormat="dd/mm/yy">
                    </p-calendar>
                </div>
            </div>
            <div class="row form-group ">
                <div class="col-6">
                    <label class="text-right col-form-label ">
                        <sup>*</sup>{{"patient.create.email" | translate}}:
                    </label>
                    <input class="ml-4" type="text" [(ngModel)]="selectedPatient.email" />
                </div>
                <div class="col-6">
                    <label class="text-right col-form-label">
                        <sup>*</sup>{{"patient.create.phone.number" | translate}}:
                    </label>
                    <input class="ml-4" type="text" numbersOnly [(ngModel)]="selectedPatient.phone" maxlength="10" />
                </div>
            </div>
            <div class="row form-group ">
                <div class="col-6">
                    <label class="text-right col-form-label">
                        <sup>*</sup>{{"patient.create.address.line.1" | translate}}
                    </label>
                    <input class="ml-4" type="text" [(ngModel)]="selectedPatient.address.addressLine1" />
                </div>
                <div class="col-6">
                    <label class="text-right col-form-label">
                        {{"patient.create.address.line.2" | translate}}
                    </label>
                    <input class="ml-4" type="text" [(ngModel)]="selectedPatient.address.addressLine2" />
                </div>
            </div>

            <div class="row form-group col-form-label">
                <div class="col-6">
                    <label class="text-right ">
                        <sup>*</sup>{{"patient.create.city" | translate}}
                    </label>
                    <input class="ml-4" type="text" [(ngModel)]="selectedPatient.address.city" />
                </div>
                <div class="col-6 ">
                    <label class="text-right col-form-label">
                        {{"patient.create.zip.code" | translate}}
                    </label>
                    <input class="ml-4" type="text" [(ngModel)]="selectedPatient.address.zipCode" maxlength="6"
                        numbersOnly />
                </div>
            </div>
            <div class="row form-group ">
                <div class="col-6">
                    <label class="text-right col-form-label">
                        <sup>*</sup>{{"patient.create.region" | translate}}
                    </label>
                    <input class="ml-4" type="text" [(ngModel)]="selectedPatient.address.region" maxlength="20" />
                </div>
                <div class="col-6">
                    <label class="text-right ">
                        <sup>*</sup>{{"patient.create.country" | translate}}
                    </label>
                    <p-dropdown [style]="{'width':'50%'}" [options]="countryOptions"
                        [(ngModel)]="selectedPatient.address.country" optionLabel='label'
                        [placeholder]="translateService.instant('patient.risk.select')" filter="true" showClear='true'>
                    </p-dropdown>
                </div>
            </div>
        </div>
        <p-footer>
            <button class="ui-button-secondary" type="button" pButton (click)="showEditModal=false"
                label="{{'buttons.cancel' | translate}}"></button>
            <button type="button" pButton icon="pi pi-check" (click)="modifyPatient()"
                label="{{'patient.create.save' | translate}}"></button>
        </p-footer>
    </p-dialog>
</div>